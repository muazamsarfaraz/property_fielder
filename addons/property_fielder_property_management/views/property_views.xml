<?xml version='1.0' encoding='utf-8'?>
<odoo>
    <data>
        
        <!-- Property Tree View -->
        <record id="view_property_tree" model="ir.ui.view">
            <field name="name">property_fielder.property.tree</field>
            <field name="model">property_fielder.property</field>
            <field name="arch" type="xml">
                <list string="Properties" decoration-danger="compliance_status == 'expired'" decoration-warning="compliance_status == 'expiring_soon'" decoration-success="compliance_status == 'compliant'">
                    <field name="property_number"/>
                    <field name="name"/>
                    <field name="property_type"/>
                    <field name="city"/>
                    <field name="zip"/>
                    <field name="partner_id"/>
                    <field name="tenant_id"/>
                    <field name="state" widget="badge"/>
                    <field name="compliance_status" widget="badge" decoration-success="compliance_status == 'compliant'" decoration-warning="compliance_status == 'expiring_soon'" decoration-danger="compliance_status in ['expired', 'non_compliant']"/>
                    <field name="flage_fire_status" widget="badge"/>
                    <field name="flage_gas_status" widget="badge"/>
                    <field name="flage_electrical_status" widget="badge"/>
                </list>
            </field>
        </record>
        
        <!-- Property Form View -->
        <record id="view_property_form" model="ir.ui.view">
            <field name="name">property_fielder.property.form</field>
            <field name="model">property_fielder.property</field>
            <field name="arch" type="xml">
                <form string="Property">
                    <header>
                        <field name="state" widget="statusbar" statusbar_visible="draft,active,vacant"/>
                    </header>
                    <sheet>
                        <div class="oe_button_box" name="button_box">
                            <button name="%(action_property_certification)d" type="action" class="oe_stat_button" icon="fa-certificate" context="{'default_property_id': id}">
                                <field name="certification_count" widget="statbutton" string="Certificates"/>
                            </button>
                            <button name="%(action_property_inspection)d" type="action" class="oe_stat_button" icon="fa-clipboard-check" context="{'default_property_id': id}">
                                <field name="inspection_count" widget="statbutton" string="Inspections"/>
                            </button>
                            <button name="%(action_property_certification)d" type="action" class="oe_stat_button" icon="fa-exclamation-triangle" invisible="expired_certification_count == 0" context="{'default_property_id': id, 'search_default_expired': 1}">
                                <field name="expired_certification_count" widget="statbutton" string="Expired"/>
                            </button>
                            <button class="oe_stat_button" icon="fa-camera" type="object" name="action_view_images">
                                <field name="image_count" widget="statbutton" string="Photos"/>
                            </button>
                        </div>

                        <field name="image" widget="image" class="oe_avatar" options="{'preview_image': 'image_medium'}"/>

                        <div class="oe_title">
                            <h1>
                                <field name="property_number" readonly="1"/>
                            </h1>
                            <label for="name"/>
                            <h2>
                                <field name="name" placeholder="Property Name"/>
                            </h2>
                        </div>
                        
                        <group>
                            <group name="property_info" string="Property Information">
                                <field name="property_type"/>
                                <field name="bedrooms"/>
                                <field name="bathrooms"/>
                                <field name="floor_area"/>
                                <field name="year_built"/>
                            </group>
                            <group name="ownership" string="Ownership">
                                <field name="partner_id"/>
                                <field name="tenant_id"/>
                            </group>
                        </group>
                        
                        <group>
                            <group name="address" string="Address">
                                <field name="street"/>
                                <field name="street2"/>
                                <field name="city"/>
                                <field name="state"/>
                                <field name="zip"/>
                                <field name="country_id"/>
                            </group>
                            <group name="location" string="GPS Location">
                                <field name="latitude"/>
                                <field name="longitude"/>
                            </group>
                        </group>
                        
                        <group name="compliance" string="FLAGE+ Compliance Status">
                            <group>
                                <field name="flage_fire_status" widget="badge"/>
                                <field name="flage_legionella_status" widget="badge"/>
                                <field name="flage_asbestos_status" widget="badge"/>
                            </group>
                            <group>
                                <field name="flage_gas_status" widget="badge"/>
                                <field name="flage_electrical_status" widget="badge"/>
                                <field name="compliance_status" widget="badge"/>
                            </group>
                        </group>
                        
                        <notebook>
                            <page string="Certifications" name="certifications">
                                <field name="certification_ids">
                                    <list decoration-danger="status == 'expired'" decoration-warning="status == 'expiring_soon'">
                                        <field name="certification_type_id"/>
                                        <field name="flage_category" widget="badge"/>
                                        <field name="issue_date"/>
                                        <field name="expiry_date"/>
                                        <field name="days_until_expiry"/>
                                        <field name="status" widget="badge"/>
                                    </list>
                                </field>
                            </page>
                            <page string="Inspections" name="inspections">
                                <field name="inspection_ids">
                                    <list>
                                        <field name="name"/>
                                        <field name="certification_type_id"/>
                                        <field name="scheduled_date"/>
                                        <field name="inspector_id"/>
                                        <field name="state" widget="badge"/>
                                        <field name="result" widget="badge"/>
                                    </list>
                                </field>
                            </page>
                            <page string="Photos" name="photos">
                                <field name="image_ids" mode="kanban">
                                    <kanban>
                                        <field name="id"/>
                                        <field name="name"/>
                                        <field name="image_small"/>
                                        <field name="category"/>
                                        <field name="is_main"/>
                                        <field name="sequence"/>
                                        <templates>
                                            <t t-name="card">
                                                <div class="oe_kanban_global_click o_kanban_image_wrapper">
                                                    <field name="image_small" widget="image" options="{'size': [128, 128]}"/>
                                                    <div class="o_kanban_details">
                                                        <strong t-if="record.name.raw_value"><field name="name"/></strong>
                                                        <div><field name="category"/></div>
                                                        <span t-if="record.is_main.raw_value" class="badge text-bg-primary">Main</span>
                                                    </div>
                                                </div>
                                            </t>
                                        </templates>
                                    </kanban>
                                </field>
                            </page>
                            <page string="Notes" name="notes">
                                <field name="notes" placeholder="Additional notes about this property..."/>
                            </page>
                        </notebook>
                    </sheet>
                    <div class="oe_chatter">
                        <field name="message_follower_ids"/>
                        <field name="activity_ids"/>
                        <field name="message_ids"/>
                    </div>
                </form>
            </field>
        </record>
        
        <!-- Property Kanban View -->
        <record id="view_property_kanban" model="ir.ui.view">
            <field name="name">property_fielder.property.kanban</field>
            <field name="model">property_fielder.property</field>
            <field name="arch" type="xml">
                <kanban class="o_kanban_small_column">
                    <field name="id"/>
                    <field name="property_number"/>
                    <field name="name"/>
                    <field name="property_type"/>
                    <field name="city"/>
                    <field name="image_small"/>
                    <field name="compliance_status"/>
                    <field name="flage_fire_status"/>
                    <field name="flage_legionella_status"/>
                    <field name="flage_asbestos_status"/>
                    <field name="flage_gas_status"/>
                    <field name="flage_electrical_status"/>
                    <templates>
                        <t t-name="card">
                            <div class="oe_kanban_global_click d-flex">
                                <div class="o_kanban_image me-2">
                                    <t t-if="record.image_small.raw_value">
                                        <field name="image_small" widget="image" options="{'size': [80, 80]}"/>
                                    </t>
                                    <t t-else="">
                                        <div class="o_kanban_image_default d-flex align-items-center justify-content-center bg-light rounded" style="width:80px;height:80px;">
                                            <i class="fa fa-building fa-2x text-muted"/>
                                        </div>
                                    </t>
                                </div>
                                <div class="o_kanban_details flex-grow-1">
                                    <div class="o_kanban_record_top mb-1">
                                        <strong><field name="property_number"/> - <field name="name"/></strong>
                                    </div>
                                    <div class="o_kanban_record_body text-muted small">
                                        <div><field name="property_type"/> â€¢ <field name="city"/></div>
                                    </div>
                                    <div class="o_kanban_record_bottom mt-2">
                                        <div class="d-flex gap-1 flex-wrap">
                                            <!-- FLAGE+ Status Icons -->
                                            <span t-attf-class="badge #{record.flage_fire_status.raw_value == 'valid' ? 'text-bg-success' : (record.flage_fire_status.raw_value == 'expiring' ? 'text-bg-warning' : (record.flage_fire_status.raw_value == 'expired' ? 'text-bg-danger' : 'text-bg-secondary'))}" title="Fire Safety">F</span>
                                            <span t-attf-class="badge #{record.flage_legionella_status.raw_value == 'valid' ? 'text-bg-success' : (record.flage_legionella_status.raw_value == 'expiring' ? 'text-bg-warning' : (record.flage_legionella_status.raw_value == 'expired' ? 'text-bg-danger' : 'text-bg-secondary'))}" title="Legionella">L</span>
                                            <span t-attf-class="badge #{record.flage_asbestos_status.raw_value == 'valid' ? 'text-bg-success' : (record.flage_asbestos_status.raw_value == 'expiring' ? 'text-bg-warning' : (record.flage_asbestos_status.raw_value == 'expired' ? 'text-bg-danger' : 'text-bg-secondary'))}" title="Asbestos">A</span>
                                            <span t-attf-class="badge #{record.flage_gas_status.raw_value == 'valid' ? 'text-bg-success' : (record.flage_gas_status.raw_value == 'expiring' ? 'text-bg-warning' : (record.flage_gas_status.raw_value == 'expired' ? 'text-bg-danger' : 'text-bg-secondary'))}" title="Gas Safety">G</span>
                                            <span t-attf-class="badge #{record.flage_electrical_status.raw_value == 'valid' ? 'text-bg-success' : (record.flage_electrical_status.raw_value == 'expiring' ? 'text-bg-warning' : (record.flage_electrical_status.raw_value == 'expired' ? 'text-bg-danger' : 'text-bg-secondary'))}" title="Electrical Safety">E</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </t>
                    </templates>
                </kanban>
            </field>
        </record>
        
        <!-- Property Search View -->
        <record id="view_property_search" model="ir.ui.view">
            <field name="name">property_fielder.property.search</field>
            <field name="model">property_fielder.property</field>
            <field name="arch" type="xml">
                <search string="Properties">
                    <field name="name"/>
                    <field name="property_number"/>
                    <field name="city"/>
                    <field name="zip"/>
                    <field name="partner_id"/>
                    <field name="tenant_id"/>
                    <filter string="Active" name="active" domain="[('state', '=', 'active')]"/>
                    <filter string="Vacant" name="vacant" domain="[('state', '=', 'vacant')]"/>
                    <separator/>
                    <filter string="Compliant" name="compliant" domain="[('compliance_status', '=', 'compliant')]"/>
                    <filter string="Expiring Soon" name="expiring_soon" domain="[('compliance_status', '=', 'expiring_soon')]"/>
                    <filter string="Expired" name="expired" domain="[('compliance_status', '=', 'expired')]"/>
                    <filter string="Non-Compliant" name="non_compliant" domain="[('compliance_status', '=', 'non_compliant')]"/>
                    <filter string="Property Type" name="group_property_type" context="{'group_by': 'property_type'}"/>
                        <filter string="City" name="group_city" context="{'group_by': 'city'}"/>
                        <filter string="Owner" name="group_owner" context="{'group_by': 'partner_id'}"/>
                        <filter string="Compliance Status" name="group_compliance" context="{'group_by': 'compliance_status'}"/></search>
            </field>
        </record>

    </data>
</odoo>